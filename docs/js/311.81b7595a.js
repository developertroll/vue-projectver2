"use strict";(self["webpackChunkvue_projectver2"]=self["webpackChunkvue_projectver2"]||[]).push([[311,136],{4285:function(e,t,r){r.d(t,{v:function(){return l}});r(560);var s=r(4870),n=r(6797),i=r.n(n),o=r(167),a=r(8865);const l=(0,s.Um)({List:localStorage.getItem("messageList")?JSON.parse(localStorage.getItem("messageList")):[],refreshList(){localStorage.setItem("messageList",JSON.stringify(this.List)),this.List=JSON.parse(localStorage.getItem("messageList"))},template:{index:"",from:"",to:"",reference:"",title:"",content:"",update:i()().format("YYYY-MM-DD"),status:!0,read:!1},createMessage(e){if(e.to.length>1)return e.to.forEach((t=>{const r={index:this.List.length,from:o.N.currentMember,to:t,reference:""===e.reference?[]:Array.isArray(e.reference)?e.reference:[e.reference],title:e.title,content:e.content,update:i()().format("YYYY-MM-DD"),status:!0,read:!1};a.j.createAlarm("messageSend",r.from,r.to),this.List.push(r)})),void this.refreshList();const t={index:this.List.length,from:o.N.currentMember,to:e.to,reference:""===e.reference?[]:Array.isArray(e.reference)?e.reference:[e.reference],title:e.title,content:e.content,update:i()().format("YYYY-MM-DD"),status:!0};this.List.push(t),a.j.createAlarm("messageSend",t.from,t.to),this.refreshList()},editMessage(e,t,r=!1){const s={index:this.List.length,from:o.N.currentMember,to:e.to,reference:""===e.reference?[]:Array.isArray(e.reference)?e.reference:[e.reference],title:e.title,content:e.content,update:i()().format("YYYY-MM-DD"),status:!0,read:!1};r&&(this.filterReplyMessageGroupReply(t).length>0?this.addReplyMessageGroup(t,s.index):this.createReplyMessageGroup(t,s.index)),this.List.push(s),a.j.createAlarm("messageSend",s.from,s.to),this.refreshList()},getAllList(){let e=[];return this.List.forEach((t=>{if(t.status){let r="";t.reference?t.reference.forEach((e=>{r+=o.N.findMemberByIndex(e).name+" ,"})):r=[],e.push({index:t.index,from:o.N.findMemberByIndex(t.from).name,to:o.N.findMemberByIndex(t.to).name,reference:r,title:t.title,content:t.content,update:t.update,status:t.status,read:t.read})}})),e},getMessage(e){const t=o.N.findMemberByIndex(e).name;return this.getAllList().filter((e=>e.to===t||e.reference.includes(t)))},findMessageByIndex(e){return this.getAllList().find((t=>t.index===e))},findOriginalMessageByIndex(e){return this.List.find((t=>t.index===e))},deleteMessage(e){const t=this.findMessageByIndex(e);t.status=!1,this.refreshList()},calculateMessageCountByMessage(e){const t=this.List.find((t=>t.index===e)),r=t.to,s=this.List.filter((e=>e.to===r)),n=s.find((t=>t.index===e));return`${s.indexOf(n)+1}/${s.length}`},referenceCheck(e){const t=this.List.find((t=>t.index===e));return t.to===o.N.currentMember},readMessage(e){const t=this.List.find((t=>t.index===e));t.read=!0,this.refreshList()},ReplyMessageGroup:localStorage.getItem("replyMessageGroup")?JSON.parse(localStorage.getItem("replyMessageGroup")):[],refreshGroup(){localStorage.setItem("replyMessageGroup",JSON.stringify(this.ReplyMessageGroup)),this.ReplyMessageGroup=JSON.parse(localStorage.getItem("replyMessageGroup"))},createReplyMessageGroup(e,t){const r={index:this.ReplyMessageGroup.length,originalMessage:e,replyMessage:[t],status:!0};this.ReplyMessageGroup.push(r),this.refreshGroup()},addReplyMessageGroup(e,t){let r=this.findGroupByOGIndex(e);void 0===r&&(r=this.filterReplyMessageGroupReply(e)[0]),r.replyMessage.push(t),this.refreshGroup()},findGroupByOGIndex(e){return this.ReplyMessageGroup.find((t=>t.originalMessage===e))},filterReplyMessageGroupReply(e){return this.ReplyMessageGroup.filter((t=>t.replyMessage.includes(e)))},getReplyChainArray(e){const t=[];if(this.findGroupByOGIndex(e)){const r=this.findGroupByOGIndex(e);return t.push(this.findOriginalMessageByIndex(r.originalMessage)),r.replyMessage.forEach((e=>{t.push(this.findOriginalMessageByIndex(e))})),t}if(this.filterReplyMessageGroupReply(e).length>0){const r=this.filterReplyMessageGroupReply(e);return r.forEach((e=>{t.push(this.findOriginalMessageByIndex(e.originalMessage)),e.replyMessage.forEach((e=>{t.push(this.findOriginalMessageByIndex(e))}))})),t}return t}})},4702:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var s=r(3396),n=r(7139);const i={class:"el-header"};function o(e,t,r,o,a,l){const d=(0,s.up)("el-button"),f=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",null,[(0,s.Wm)(d,{type:"primary",onClick:l.openDialog},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(r.title),1)])),_:1},8,["onClick"])]),(0,s.Wm)(f,{modelValue:a.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>a.dialogVisible=e),"append-to-body":"","show-close":!1},{header:(0,s.w5)((()=>[(0,s._)("div",i,[(0,s._)("h2",null,(0,n.zw)(r.title),1),(0,s.Wm)(d,{onClick:l.closeDialog},{default:(0,s.w5)((()=>[(0,s.Uk)("닫기")])),_:1},8,["onClick"])])])),default:(0,s.w5)((()=>[(0,s.WI)(e.$slots,"default",{onSaveForm:t[0]||(t[0]=(...e)=>l.saveForm&&l.saveForm(...e))})])),_:3},8,["modelValue"])])}var a={name:"dialogSlot",data(){return{dialogVisible:!1}},props:{title:{type:String,default:""}},methods:{openDialog(){this.dialogVisible=!0},closeDialog(){this.dialogVisible=!1},saveForm(e){this.$emit("saveForm",e),this.closeDialog()}}},l=r(89);const d=(0,l.Z)(a,[["render",o]]);var f=d},6311:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var s=r(3396);const n={class:"formContanier"},i={class:"editor"},o={class:"CenterButtons"};function a(e,t,r,a,l,d){const f=(0,s.up)("assignMember"),p=(0,s.up)("dialogSlot"),u=(0,s.up)("el-input"),m=(0,s.up)("el-form-item"),c=(0,s.up)("QuillEditor"),h=(0,s.up)("el-button"),g=(0,s.up)("el-form");return(0,s.wg)(),(0,s.iD)("div",n,[(0,s.Wm)(g,{model:l.form},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{label:"받는사람"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{modelValue:l.showTo,"onUpdate:modelValue":t[0]||(t[0]=e=>l.showTo=e),readonly:"",disabled:r.replyCheck},(0,s.Nv)({_:2},[r.replyCheck?void 0:{name:"append",fn:(0,s.w5)((()=>[(0,s.Wm)(p,{title:"배정하기",ref:"dialog"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{onSaveMember:d.addressMember,where:"to"},null,8,["onSaveMember"])])),_:1},512)])),key:"0"}]),1032,["modelValue","disabled"])])),_:1}),(0,s.Wm)(m,{label:"참조"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{modelValue:l.showRef,"onUpdate:modelValue":t[1]||(t[1]=e=>l.showRef=e),readonly:""},{append:(0,s.w5)((()=>[(0,s.Wm)(p,{title:"배정하기",ref:"dialog"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{onSaveMember:d.addressMember,where:"ref"},null,8,["onSaveMember"])])),_:1},512)])),_:1},8,["modelValue"])])),_:1}),(0,s.Wm)(m,{label:"제목"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{modelValue:l.form.title,"onUpdate:modelValue":t[2]||(t[2]=e=>l.form.title=e),placeholder:"제목을 입력하세요"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(m,{label:"내용"},{default:(0,s.w5)((()=>[(0,s._)("div",i,[(0,s.Wm)(c,{content:l.form.content,"onUpdate:content":t[3]||(t[3]=e=>l.form.content=e),contentType:"html",theme:"snow",toolbar:"essential",placeholder:"줄이 늘어날수록 창이 자동으로 늘어납니다",ref:"Editor"},null,8,["content"])])])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s.Wm)(h,{type:"primary",onClick:d.sendMessage},{default:(0,s.w5)((()=>[(0,s.Uk)("작성")])),_:1},8,["onClick"]),(0,s.Wm)(h,{type:"primary",onClick:d.returnToMain},{default:(0,s.w5)((()=>[(0,s.Uk)("취소")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model"])])}var l=r(167),d=r(4702),f=r(2832),p=r(4285),u=r(6e3),m={name:"createMessage",components:{dialogSlot:d["default"],assignMember:f["default"]},props:{parentIndex:{type:Number,required:!0},replyCheck:{type:Boolean,default:!1}},data(){return{form:{to:"",from:"",reference:"",title:"",content:"",update:""},showTo:"",showRef:""}},methods:{addressMember(e,t){if(e.length>1){let r=e.map((e=>{let t=l.N.findMemberByIndex(e);return`${t.name}(${t.department})`})).join(", ");"to"===t?(this.showTo=r,this.form.to=e):(this.showRef=r,this.form.reference=e)}else{let r=Array.isArray(e)?e[0]:e;"to"===t?(this.form.to=r,this.showTo=`${l.N.findMemberByIndex(r).name}(${l.N.findMemberByIndex(r).department})`):(this.form.reference=r,this.showRef=`${l.N.findMemberByIndex(r).name}(${l.N.findMemberByIndex(r).department})`)}this.$refs.dialog.closeDialog()},sendMessage(){this.$emit("editMessage",this.form)},giveCurrentMessage(){const e=p.v.findMessageByIndex(this.parentIndex),t=p.v.findOriginalMessageByIndex(this.parentIndex);console.log(t.from,t.to),this.form.to=this.replyCheck?t.from:"",this.form.form=t.to,this.showTo=this.replyCheck?`${l.N.findMemberByIndex(t.from).name}(${l.N.findMemberByIndex(t.from).department})`:"",this.form.title=this.replyCheck?`RE: ${e.title}`:`FW: ${e.title}`,this.form.content=`<p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p>=============================</p><p>보낸사람:${e.from}</p><p>받는사람:${e.to}</p><p>참조:${e.reference}</p><p><br/></p><p><br/></p>${e.content}`},returnToMain(){u.T.confirm("정말 취소하시겠습니까?","경고",{confirmButtonText:"예",cancelButtonText:"아니오",type:"warning"}).then((()=>{this.$emit("returnToMain")})).catch((()=>{}))}},mounted(){this.giveCurrentMessage()}},c=r(89);const h=(0,c.Z)(m,[["render",a],["__scopeId","data-v-9b97d028"]]);var g=h}}]);
//# sourceMappingURL=311.81b7595a.js.map